{% extends 'quotes/base.html' %}

{% block content %}
<div class="quote-container">
    <div class="quote-card fade-in">
        <div class="card-body text-center">
            {% if quote %}
                <blockquote class="blockquote">
                    <p class="mb-4">"{{ quote.text }}"</p> 
                    <footer class="blockquote-footer mt-3">
                        {{ quote.source }}
                    </footer>
                </blockquote>
                
                <div class="rating-buttons mt-4">  
                    <button onclick="rateQuote({{ quote.id }}, 'like')" class="btn btn-success">
                        <i class="fas fa-thumbs-up"></i>  <span id="likes-{{ quote.id }}">{{ quote.likes }}</span>
                    </button>
                    <button onclick="rateQuote({{ quote.id }}, 'dislike')" class="btn btn-danger">
                        <i class="fas fa-thumbs-down"></i> <span id="dislikes-{{ quote.id }}">{{ quote.dislikes }}</span>
                    </button>
                </div>
                
                <div class="quote-stats mt-4">  
                    Просмотров: {{ quote.views }} | Вес: {{ quote.weight }}
                </div>
            {% else %}
                <p class="no-quotes">Цитат пока нет. <a href="{% url 'add_quote' %}">Добавьте первую!</a></p>
            {% endif %}
        </div>
    </div>
    
    <div class="next-quote mt-4"> 
        <a href="{% url 'random_quote' %}" class="btn btn-primary btn-lg">Следующая цитата</a> 
    </div>
</div>

<script>
function rateQuote(quoteId, action) {
    fetch(`/quote/${quoteId}/${action}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById(`likes-${quoteId}`).textContent = data.likes;
        document.getElementById(`dislikes-${quoteId}`).textContent = data.dislikes;
    });
}
</script>

{% endblock %}