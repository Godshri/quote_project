{% extends 'quotes/base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h2>–°–ª—É—á–∞–π–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞</h2>
            </div>
            <div class="card-body">
                {% if quote %}
                    <blockquote class="blockquote">
                        <p>{{ quote.text }}</p>
                        <footer class="blockquote-footer">
                            {{ quote.source }}
                        </footer>
                    </blockquote>
                    
                    <div class="mt-3">
                        <button onclick="rateQuote({{ quote.id }}, 'like')" class="btn btn-success">
                            üëç <span id="likes-{{ quote.id }}">{{ quote.likes }}</span>
                        </button>
                        <button onclick="rateQuote({{ quote.id }}, 'dislike')" class="btn btn-danger">
                            üëé <span id="dislikes-{{ quote.id }}">{{ quote.dislikes }}</span>
                        </button>
                    </div>
                    
                    <div class="mt-3 text-muted">
                        –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: {{ quote.views }} | –í–µ—Å: {{ quote.weight }}
                    </div>
                {% else %}
                    <p>–¶–∏—Ç–∞—Ç –ø–æ–∫–∞ –Ω–µ—Ç. <a href="{% url 'add_quote' %}">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</a></p>
                {% endif %}
            </div>
        </div>
        
        <div class="mt-3 text-center">
            <a href="{% url 'random_quote' %}" class="btn btn-primary">–°–ª–µ–¥—É—é—â–∞—è —Ü–∏—Ç–∞—Ç–∞</a>
        </div>
    </div>
</div>

<script>
function rateQuote(quoteId, action) {
    fetch(`/quote/${quoteId}/${action}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById(`likes-${quoteId}`).textContent = data.likes;
        document.getElementById(`dislikes-${quoteId}`).textContent = data.dislikes;
    });
}
</script>
{% endblock %}